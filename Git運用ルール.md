# Git 運用ルール

## はじめに

-   このドキュメントは、Git や GitHub を初めて使う人でもつまずかないように、プロジェクト内で共通して守りたいルールと背景を解説します。
-   Git は、ファイルの変更履歴を保存・共有できるバージョン管理ツールです。複数人が同じファイルを編集しても、「いつ」「誰が」「どのように」変更したのかを明確に追跡できます。
-   ここで説明するルールは、「安全に」「迷わず」「気持ちよく」チーム開発を進めるための基本です。困ったらこのページを読み直してください。

## 主要な用語と考え方

| 用語                          | 意味                                                                                         | イメージ           |
| ----------------------------- | -------------------------------------------------------------------------------------------- | ------------------ |
| リポジトリ                    | プロジェクトのフォルダと履歴を丸ごと保管する場所。GitHub 上のリポジトリはサーバー側の保存庫  | 書庫・金庫         |
| ローカルリポジトリ            | 自分の PC 内にあるリポジトリ。`git clone` すると手元にコピーされる                           | 自宅の作業場       |
| リモートリポジトリ            | GitHub などサーバー上にあるリポジトリ                                                        | 会社の共有倉庫     |
| ブランチ                      | 作業用の枝。ここで作業すると、他の枝に影響を与えずに変更を試せる                             | 作業用の小道       |
| `main` ブランチ               | プロジェクトの最新・安定版を保つ「基準となる枝」。常にデプロイ可能な状態をキープ             | 公式リリース       |
| 作業ブランチ (`dev_name`)     | 個々人の作業用ブランチ。`dev_tanaka` のように自分の名前を付ける                              | 自分専用の作業小道 |
| `deploy` ブランチ             | 本番環境へデプロイする直前の確認用ブランチ。`main` の内容をまとめて反映するために使用        | 出荷待ち置き場     |
| コミット                      | 変更をスナップショットとして保存する操作。メッセージには「何を」「なぜ」変更したのかを書く   | 作業日誌           |
| プルリクエスト (Pull Request) | 自分の作業をチームに共有し、レビューとマージをお願いする手続き。変更内容の説明と確認がセット | 作業報告＆承認申請 |

## ブランチ構成と役割

-   `main`: 常に動作確認済みの最新状態。直接変更せず、プルリクエストを通じて更新します。
-   `dev_name`: 個人作業用。`git checkout -b dev_yourname` で作成し、ここで作業します。
-   `deploy`: 本番デプロイ時に `main` の内容をまとめてマージします。普段は触りません。

## 典型的な作業の流れ

> 変更を行う前に必ず「今どのブランチで作業しているか？」を確認しましょう。迷ったら `git status` を実行すると安心です。

### 1. 新しい作業を始める準備

1. `main` ブランチを最新版に更新します。
    ```bash
    git checkout main      # main ブランチに移動
    git pull origin main   # リモートから最新状態を取得
    ```
2. 個人用ブランチを作成するか、すでにある作業ブランチへ移動します。
    ```bash
    git checkout -b dev_tanaka   # 新規作成（初回のみ）
    # もしくは
    git checkout dev_tanaka      # 既存ブランチに戻る
    ```
3. `main` の最新内容が取り込まれているか確認し、不足していればマージします。
    ```bash
    git merge main    # main の変更を取り込む
    ```

### 2. コードの修正と確認

-   ファイルを編集し、動作確認やテストを実行します。
-   作業の区切りが付いたら変更内容を確認します。
    ```bash
    git status   # 変更されたファイルを確認
    git diff     # 具体的な差分を確認
    ```

### 3. 変更をコミットする

1. 保存したいファイルをステージングします。
    ```bash
    git add <変更したファイル>
    # まとめて追加する場合は
    git add .
    ```
2. コミットメッセージには「変更の一言要約 + 背景」まで書けるとベターです。
    ```bash
    git commit -m "ログイン画面のレイアウト崩れを修正"
    ```
    - 例: `git commit -m "APIレスポンスのnull対策を追加 (#123)"`
    - 迷ったら「何を」「なぜ」を書けば十分です。

### 4. プッシュ前に再度 main を取り込む理由

-   他メンバーが `main` を更新している可能性があります。自分の変更を `main` の最新状態に合わせておくと、プルリクエスト時のコンフリクトを減らせます。
-   手順は次のとおりです。
    ```bash
    git checkout main
    git pull origin main      # main を最新版に更新
    git checkout dev_tanaka
    git merge main            # 自分のブランチへ取り込む
    # ※ rebase を使いたい場合は `git rebase main` でも OK
    ```
-   マージ後、もう一度テストを実行すると安心です。

### 5. リモートリポジトリへプッシュする

```bash
git push -u origin dev_tanaka   # 最初の一回だけ -u が必要
# 2回目以降は
git push origin dev_tanaka
```

-   プッシュに成功すると、GitHub 上に自分の変更が保存されます。

### 6. プルリクエストを作成する

プルリクエスト（PR）は、他のメンバーに自分の作業内容を共有し、レビューと `main` への取り込みを依頼する場です。

1. GitHub のリポジトリページを開きます。
2. 「Pull requests」タブ → 「New pull request」をクリック。
3. `base: main`（取り込み先） ← `compare: dev_tanaka`（自分のブランチ）を選択。
4. 差分をざっと確認し、問題なければ「Create pull request」をクリック。
5. タイトルと本文に以下のような情報を書くと親切です。
    - 目的: 何を解決する変更か？
    - 対応内容: どのファイルをどう直したか？
    - テスト結果: 実行したテストや確認手順。
6. 「Create pull request」で送信。

> レビューコメントをもらったら、内容を反映した上で再度コミット＆プッシュすれば PR に自動で反映されます。

### 7. プルリクエストがマージされた後

-   PR が承認・マージされたら、不要になった作業ブランチを削除します。
    ```bash
    git branch -d dev_tanaka           # ローカル削除
    git push origin --delete dev_tanaka # リモート削除
    ```
-   次の作業を始めるときは 1. の手順から再スタートします。

## 注意・ルールのまとめ

-   直接 `main` へコミット・プッシュしない。必ずブランチ + プルリクエストを経由する。
-   プッシュ前・マージ前にはローカルテストを必ず実行する。
-   こまめにコミットして履歴を細かく残す。コミット単位でレビューしやすくなる。
-   コミットメッセージは簡潔かつ具体的に。後から読み返す自分のためでもあります。
-   PR がマージされたブランチは削除し、リポジトリを整理整頓する。

## よくある質問（FAQ）

-   **Q. コミットをまとめたい/修正したい場合は？**  
    `git commit --amend` で直前のコミットを修正できます。複数まとめるときは `git rebase -i` を使用します（慣れてからで OK）。

-   **Q. コンフリクトが出たらどうすればいい？**  
    対象ファイルをエディタで開くと、`<<<<<<`, `======`, `>>>>>>` のような区切りが出ています。どの変更を残すか話し合いながら解決し、`git add` → `git commit` で記録します。

-   **Q. 変更を捨てたいときは？**  
    まだコミットしていないファイルなら `git checkout -- <ファイル名>` で変更前に戻せます。コミット済みの場合は `git revert` で差分を打ち消すコミットを作ります。

## トラブルシューティング

-   `git pull` がうまくいかない: まず `git status` で作業中の変更がないか確認し、あればコミットまたは退避（`git stash`）してから再実行。
-   GitHub へのログイン情報が合わない: `git config --list` で設定を確認し、必要に応じて `git config user.name` / `git config user.email` を設定。
-   どこまで作業したか分からなくなった: `git log --oneline --graph` で履歴を目で追うと現在位置を把握しやすくなります。

---

必要に応じて、本ドキュメントへ追記・改善してください。分からない用語や手順があれば、チーム内で気軽に相談しましょう。みんなで同じ形を守ることで、安心して開発を進められます。
