# 38_顧客請求データ出力（A05_51）

## 機能概要

顧客への請求データをExcel形式で出力する機能です。月次請求書の一括出力を行います。

## 実装状況

**未実装（保留）**

## 備考

### 将来の実装予定

本機能は現在未実装（保留）です。将来的には以下の機能を実装する予定です：

#### 想定される機能

1. **請求データのExcel出力**
   - 月次単位での請求データ出力
   - 顧客ごとの請求明細
   - 承認済みタスクの集計

2. **一括出力**
   - 全顧客の請求データを一括出力
   - 顧客選択による個別出力
   - ZIP圧縮による複数ファイル出力

3. **出力形式**
   - Excel形式（.xlsx）
   - CSV形式
   - PDF形式

4. **出力項目**
   - 顧客情報（会社名、請求先住所）
   - タスク明細（日付、秘書名、ランク、作業時間、単価、金額）
   - 集計情報（合計時間、合計金額）
   - 請求月、請求日

#### 現在の代替運用

現在は以下の方法で運用されています：

1. **秘書による請求書発行**
   - 秘書が個別に請求書を発行（Excel形式）
   - 秘書の請求サマリー画面から「請求書発行」ボタンで出力
   - InvoiceService.issueInvoiceExcel() により実装済み

2. **請求サマリー画面での確認**
   - 請求サマリー画面（39_請求サマリー表示.md）で請求額を確認
   - 画面からのコピー＆ペーストで外部ツールへ転記

3. **手動集計**
   - 必要に応じて管理者が手動で集計

### 実装時の考慮事項

将来実装する際には以下を考慮する必要があります：

1. **テンプレート設計**
   - 顧客向け請求書テンプレートの作成
   - 複数テンプレートの対応（顧客ごとの要望）
   - 秘書向けテンプレートとの統合

2. **データ集計**
   - 承認済みタスクの抽出（`approved_at IS NOT NULL`）
   - 顧客×秘書×ランクごとの集計
   - 合計金額の計算

3. **ファイル管理**
   - 出力ファイルの保存場所
   - ファイル名の命名規則
   - 過去の請求データの保持期間

4. **権限管理**
   - 請求データ出力権限の設計
   - 顧客ごとの閲覧制限

5. **監査ログ**
   - 出力履歴の記録
   - 出力者の記録

6. **画面設計**
   - 請求データ出力画面の追加
   - 出力条件（対象月、顧客選択）の指定
   - プレビュー機能

7. **既存機能との統合**
   - 秘書の請求書発行機能（InvoiceService.issueInvoiceExcel()）との統合
   - テンプレートの共通化

### 関連機能

- **請求サマリー表示** (39_請求サマリー表示.md): 顧客への請求額集計表示
- **業務承認** (32_業務承認.md): 請求対象タスクの承認
- **業務一覧表示** (30_業務一覧表示.md): 承認済みタスクの確認
- **秘書：請求書発行** (秘書機能): 秘書による請求書Excel出力（実装済み）
