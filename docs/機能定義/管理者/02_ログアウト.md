# 02_ログアウト（A01_92）

## 機能概要

ログイン中のシステム管理者がセッションを破棄してシステムからログアウトする機能です。ログアウト後はログイン画面へリダイレクトされます。

## 実装状況

**実装済み**

## URL一覧

| HTTPメソッド | URL | 画面/処理名 | 説明 |
|---|---|---|---|
| GET | `/admin/logout` | ログアウト処理 | セッション破棄後、ログイン画面へリダイレクト |

## 画面フロー

```
[任意の管理者画面]
    ↓ ログアウトボタン/リンククリック
    ↓ GET /admin/logout
    ↓ セッション無効化
    ↓
[ログイン画面] (/admin) へリダイレクト
```

## バックエンド処理詳細

### サービスクラス

- **クラス**: [CommonService.java](../../../src/main/java/service/CommonService.java:633)
- **メソッド**: `adminLogout()`

### 処理フロー

1. **セッション取得**
   - `req.getSession(false)` で既存のセッションを取得（新規作成しない）
   - セッションが存在しない場合は `null` が返される

2. **セッション無効化**
   - セッションが存在する場合、`session.invalidate()` を実行
   - セッションに保存されていた全ての属性（`loginUser` など）が削除される

3. **リダイレクト**
   - ログイン画面（`/admin`）へリダイレクト
   - 以降の画面アクセスは未認証状態となり、ログインが必要となる

### トランザクション管理

- **データベースアクセス不要**: セッション操作のみのため、トランザクション不使用
- `TransactionManager` は使用しない

### DAO呼び出し

- **なし**: データベース操作は行わない

### セキュリティ

- **セッション完全破棄**: `invalidate()` によりセッションIDが無効化され、再利用不可
- **リダイレクト強制**: ログアウト後は必ずログイン画面へ遷移

## ビューファイル

- **直接的なビューなし**: 処理後は `/admin` へリダイレクトされるため、専用JSPは存在しない
- リダイレクト先: [/WEB-INF/jsp/common/admin/login.jsp](../../../src/main/webapp/WEB-INF/jsp/common/admin/login.jsp)

## データモデル

### セッションから削除される属性

- **loginUser** (LoginUser)
  - `systemAdmin` (SystemAdmin): 管理者情報
  - `authority` (int): 権限値

## エラーハンドリング

### 正常系のみ

- ログアウト処理は常に成功する
- セッションが存在しない場合でもエラーにならず、単純にログイン画面へリダイレクト
- 例外処理は不要

## 備考

- ログアウト処理は GET メソッドで実装されているため、リンクから直接呼び出し可能
- セッションタイムアウト時も同様にログイン画面へリダイレクトされる（FrontControllerのセッションチェック）
- ブラウザを閉じてもセッションは残る場合があるが、ログアウトを実行することで確実にセッションを破棄できる
